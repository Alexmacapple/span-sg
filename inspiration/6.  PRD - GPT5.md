Parfait. Voici une version « PRD v3.1 » améliorée, fidèle au MVP, sans sur-ingénierie. J’ai conservé ta structure, resserré où nécessaire, ajouté les garanties de conformité et corrigé les points de fragilité (scoring, CI, preview, références légales). Tout reste simple, fonctionnel et efficace.

# PRD v3.1 SPAN SG – MkDocs avec checklist officielle

**Version** 3.1  
**Date** 30 septembre 2025  
**Owner** Alexandra  
**Validateurs** Bertrand, Alex  
**Sponsor** Yves (validation production uniquement)

---

## 1. objectif

Créer un framework simple et modulaire pour le SPAN SG permettant

1. édition décentralisée par service, 2) agrégation automatique SG, 3) versioning, 4) export HTML/PDF, 5) scoring automatique sur la checklist DINUM de 31 points.  
    Principe directeur: simple, fonctionnel, efficace.
    

---

## 2. architecture simplifiée

### 2.1 structure pyramidale

```
Niveau 1 : SPAN SG (Global)
  ├─ Niveau 2 : Modules Services (SNUM, SIRCOM, SRH, SIEP, SAFI, BGS)
  │   └─ Niveau 3 : Détails par service
  └─ (Futur) extensions autres directions
```

### 2.2 structure des fichiers

```
span-sg/
├─ mkdocs.yml
├─ mkdocs-pdf.yml
├─ docker-compose.yml
├─ .github/workflows/build.yml
├─ docs/
│  ├─ index.md
│  ├─ synthese.md                # généré par script
│  ├─ modules/
│  │  ├─ _template.md
│  │  ├─ snum.md
│  │  ├─ sircom.md
│  │  ├─ srh.md
│  │  ├─ siep.md
│  │  ├─ safi.md
│  │  └─ bgs.md
│  └─ assets/custom.css
├─ scripts/calculate_scores.py
├─ exports/                      # non versionné
└─ site/                         # non versionné
```

---

## 3. template module obligatoire v3.1

Points clés

1. seuls les 31 points officiels sont scorés
2. marquage minimal `<!-- DINUM -->` sur chaque point officiel
3. front-matter minimal pour traçabilité
    

```markdown
---
service: SIRCOM
referent: "Prénom Nom"
updated: "2025-09-30"
---

# SPAN [SERVICE] - Schéma Pluriannuel d'accessibilité numérique

**Période** 2025-2027  
**Score global** [X/31] questions validées ([XX] %)  
**Dernière mise à jour** [DATE]

## 1. stratégie et politique

- [ ] La stratégie numérique intègre l’accessibilité comme composante essentielle <!-- DINUM -->
  - État [Non démarré/En cours/Réalisé]
  - Actions [...]
  - Échéance [...]

- [ ] La politique promeut l’intégration des personnes en situation de handicap <!-- DINUM -->
  - État [...]
  - Actions [...]

## 2. référent accessibilité numérique

- [ ] Un référent accessibilité numérique est désigné <!-- DINUM -->
  - Nom [...]
  - % temps dédié [...]

- [ ] Les missions du référent sont clairement définies <!-- DINUM -->
  - Fiche de poste [Oui/Non]
  - Périmètre [...]

## 3. ressources humaines et financières

- [ ] Les ressources humaines dédiées sont identifiées <!-- DINUM -->
  - Effectifs [X ETP]

- [ ] Les ressources financières sont allouées <!-- DINUM -->
  - Budget 2025 [...] €
  - Budget 2026 [...] €
  - Budget 2027 [...] €

## 4. compétences et recrutement

- [ ] Les compétences accessibilité sont dans les fiches de poste <!-- DINUM -->
  - Postes concernés [...]

- [ ] Le recrutement prend en compte les compétences accessibilité <!-- DINUM -->
  - Grille évaluation [Oui/Non]

## 5. formation et sensibilisation

- [ ] Des formations accessibilité sont planifiées <!-- DINUM -->
  - Agents à former [X]
  - Planning [...]

- [ ] La sensibilisation est intégrée aux programmes <!-- DINUM -->
  - Sessions/an [X]

## 6. moyens techniques et expertises

- [ ] Les moyens techniques de test sont en place <!-- DINUM -->
  - Outils [...]

- [ ] Appel à expertises externes si nécessaire <!-- DINUM -->
  - Prestataires [...]
  - Budget [...] €

## 7. organisation interne et contrôle

- [ ] L’organisation soutient l’accessibilité <!-- DINUM -->
  - Comité dédié [Oui/Non]
  - Process définis [Oui/Non]

- [ ] Des modalités de contrôle sont établies <!-- DINUM -->
  - Fréquence audits [...]

## 8. clauses contractuelles

- [ ] L’accessibilité figure dans les clauses contractuelles <!-- DINUM -->
  - Marchés concernés X/Y

- [ ] Les critères de sélection intègrent l’accessibilité <!-- DINUM -->
  - Pondération [X] %

## 9. mise en conformité et suivi

- [ ] Les nouveaux projets intègrent l’accessibilité dès la conception <!-- DINUM -->
  - Process défini [Oui/Non]

- [ ] Les tests incluent des personnes handicapées <!-- DINUM -->
  - Panel testeurs [Oui/Non]

- [ ] Des évaluations sont prévues pour tous les services <!-- DINUM -->
  - Planning [...]
  - Services audités X/Y

- [ ] Un calendrier de corrections est établi <!-- DINUM -->
  - Actions prioritaires [...]

## 10. mesures supplémentaires

- [ ] Accès en langue des signes (vidéos) <!-- DINUM -->
- [ ] Traduction en langage simplifié (FALC) <!-- DINUM -->
- [ ] Critères AAA pris en compte <!-- DINUM -->

## 11. bilan et plans d'actions

- [ ] Bilan annuel réalisé <!-- DINUM -->
  - Dernier bilan [DATE]

- [ ] Plans publiés en ligne (format accessible) <!-- DINUM -->
  - URL [...]

## périmètre du service

| Type | Total | Audités | Conformes | Score |
|------|-------|---------|-----------|-------|
| Sites web | | | | % |
| Intranets | | | | % |
| Applications | | | | % |

## plan d'actions prioritaires 2025

| Action | Échéance | Responsable | Budget | Statut |
|--------|----------|-------------|--------|--------|
| | T1 2025 | | € | |
| | T2 2025 | | € | |

## publication et conformité

- URL de la déclaration d’accessibilité  
- Mention de charge disproportionnée le cas échéant  
- Contact accessibilité

---
*Dernière mise à jour [date]*
```

Remarque: 31 lignes cochables portent le marqueur `<!-- DINUM -->`. Les sous-détails et plans d’action ne sont pas scorés.

---

## 4. configuration technique minimale

### 4.1 mkdocs config

```yaml
# mkdocs.yml
site_name: SPAN SG
site_url: https://[a-definir].github.io/span-sg/
repo_url: https://github.com/[organisation]/span-sg
strict: true

theme:
  name: material
  language: fr
  features:
    - navigation.tabs
    - navigation.sections
    - toc.integrate

plugins:
  - search:
      lang: fr
  - pdf-export:
      combined: true
      combined_output_path: exports/span-sg.pdf

nav:
  - Accueil: index.md
  - Synthèse: synthese.md
  - Modules Services:
    - SNUM: modules/snum.md
    - SIRCOM: modules/sircom.md
    - SRH: modules/srh.md
    - SIEP: modules/siep.md
    - SAFI: modules/safi.md
    - BGS: modules/bgs.md

markdown_extensions:
  - tables
  - toc:
      permalink: true
```

### 4.2 script de calcul des scores

Objectif: compter uniquement les cases taguées DINUM, garantir 31 points par module, générer `docs/synthese.md`, échouer si périmètre incohérent.

```python
#!/usr/bin/env python3
import re
from pathlib import Path
from datetime import datetime

CHECK_TAG = "DINUM"
FENCE_RE = re.compile(r"```.*?```", re.S)
BOX_RE = re.compile(r"- \[(x|X| )\].*?<!--\s*%s\s*-->" % CHECK_TAG)

def load_text(p: Path) -> str:
    return FENCE_RE.sub("", p.read_text(encoding="utf-8"))

def score_module(p: Path):
    boxes = BOX_RE.findall(load_text(p))
    total = len(boxes)
    checked = sum(1 for b in boxes if b.lower() == "x")
    return checked, total

def generate_summary():
    modules_dir = Path("docs/modules")
    rows = [
        "# Tableau de bord SPAN SG",
        f"*Mis à jour le {datetime.now():%d/%m/%Y}*",
        "",
        "| Service | Score | Statut |",
        "|---------|-------|--------|",
    ]
    total_checked = 0
    total_items = 0
    errors = []

    for module in sorted(modules_dir.glob("*.md")):
        if module.name.startswith("_"):
            continue
        checked, total = score_module(module)
        if total not in (0, 31):
            errors.append(f"{module.name}: {total} points tagués <!-- {CHECK_TAG} --> au lieu de 31")
        pct = round((checked / total) * 100, 1) if total else 0.0
        status = "✓ Conforme" if pct >= 75 else "En cours"
        rows.append(f"| {module.stem.upper()} | {checked}/{total} ({pct}%) | {status} |")
        total_checked += checked
        total_items += total

    global_pct = round((total_checked / total_items) * 100, 1) if total_items else 0.0
    rows.append(f"| **TOTAL** | **{total_checked}/{total_items} ({global_pct}%)** | **Global** |")

    Path("docs/synthese.md").write_text("\n".join(rows) + "\n", encoding="utf-8")

    if errors:
        print("Erreurs de périmètre:")
        for e in errors:
            print(" -", e)
        return 2
    return 0

if __name__ == "__main__":
    raise SystemExit(generate_summary())
```

### 4.3 docker setup

```dockerfile
# Dockerfile
FROM squidfunk/mkdocs-material:latest
WORKDIR /docs
RUN pip install mkdocs-pdf-export-plugin
EXPOSE 8000
CMD ["mkdocs", "serve", "--dev-addr=0.0.0.0:8000"]
```

```yaml
# docker-compose.yml
version: '3'
services:
  mkdocs:
    build: .
    volumes:
      - .:/docs
    ports:
      - "8000:8000"
```

### 4.4 github actions simple

Ordre corrigé: calcul des scores avant build.

```yaml
# .github/workflows/build.yml
name: Build SPAN

on:
  push:
    branches: [main, draft]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install mkdocs-material
          pip install mkdocs-pdf-export-plugin

      - name: Calculate SPAN scores
        run: python scripts/calculate_scores.py

      - name: Build site
        run: mkdocs build

      - name: Generate PDF
        run: mkdocs build --config-file mkdocs-pdf.yml

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: span-site
          path: |
            site/
            exports/

  deploy:
    if: github.ref == 'refs/heads/main'
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
```

## 4.5 export PDF avec fallback robuste

Objectif  
Garantir un export PDF fiable sans bloquer le build.

Choix tranché

1. Plugin principal: `mkdocs-pdf-export-plugin`
2. Fallback automatique: `mkdocs-with-pdf`
3. Filet de sécurité ultime: impression navigateur de Material (Ctrl+P) sur la page « Synthèse »

Dépendances

`pip install mkdocs-pdf-export-plugin mkdocs-with-pdf`

Fichier additionnel `mkdocs-with-pdf.yml`

`site_name: SPAN SG theme:   name: material plugins:   - with-pdf:       output_path: exports/span-sg.pdf       cover_title: "SPAN SG"       toc_level: 2`

GitHub Actions (extrait remplacé)

      `- name: Generate PDF (plugin principal)         run: mkdocs build --config-file mkdocs-pdf.yml         continue-on-error: true        - name: Generate PDF fallback (mkdocs-with-pdf si échec)         if: failure()   # ne s’exécute que si l’étape précédente a échoué         run: mkdocs build --config-file mkdocs-with-pdf.yml`

Procédure manuelle de repli

1. Ouvrir le site généré
2. Aller sur « Synthèse »
3. Imprimer en PDF via le navigateur, activer « en-têtes et pieds de page »

Critères d’acceptation
- Un PDF est présent dans `exports/span-sg.pdf` à l’issue du pipeline, qu’il provienne du plugin principal ou du fallback.
- En cas d’échec des deux, la procédure manuelle produit un PDF non vide signé par la release.
---

## 5. workflow git simplifié

Branches  
main production  
draft preview  
feature/ modifications par service

Process

1. service crée `feature/update-[service]`
2. modifie son module
3. PR vers `draft`
4. revue Bertrand/Alex
5. preview automatique `draft`
6. PR `draft` vers `main`
7. Yves valide
8. tag version

Gestion d’urgence  
hotfix/ vers main pour corrections critiques avec revue rapide.

Checklist de revue PR (8 lignes)

1. 31 points DINUM présents    
2. pas de cases orphelines
3. front-matter présent
4. dates cohérentes
5. liens valides
6. synthèse générée par CI
7. pas d’identifiants en clair
8. orthographe titre et service

---

## 6. authentification et accès

Repository privé.  
Preview `draft`: accès via GitHub authentifié de l’organisation ou hébergement intranet derrière proxy SSO.  
Production `main`: GitHub Pages orga ou intranet.  
Suppression des identifiants génériques du PRD.

Secrets: uniquement via `secrets` GitHub. Aucun secret en clair dans le repo.

---

## 7. comparaisons et traçabilité

Via Git  
`git diff v1.0.0 v1.1.0 docs/`  
`git log docs/modules/snum.md`  
Releases GitHub pour tags et changelog succinct.

---

## 8. guide contributeur (1 page)

Option A interface GitHub (débutants)

1. aller sur github.com/[org]/span-sg
2. docs/modules/[service].md
3. crayon Edit
4. cocher uniquement les lignes avec `<!-- DINUM -->`
5. Commit changes
6. PR vers `draft`

Option B Git local (avancés)  
clone, branche, éditer, docker compose up, commit, push, PR.

---

## 9. maintenance minimale

Hebdomadaire  
revue PR, merge vers draft, calcul automatique des scores, test preview

Mensuelle  
merge draft → main, tag version, export PDF, contrôle cohérence 31 points

Trimestrielle  
mise à jour dépendances, revue globale, analyse progression des scores

---

## 10. conformité et références

Ajouter en bas de `docs/index.md`  
Références légales essentielles

- Article 47 loi du 11 février 2005
- RGAA en vigueur
- Déclaration d’accessibilité du service
- Mention de charge disproportionnée le cas échéant
- Contact accessibilité
    
Chaque module  
champ URL de déclaration, date de publication du plan annuel, point de contact.

---

## 11. décisions et hypothèses mvp

Décisions  
workflow simplifié, intégrations différées, adoption Git progressive, scoring strict sur 31 points marqués.

Hypothèses  
référents en cours, niveau technique hétérogène, SPAN existants à mapper, horizon 3 ans.

Hors périmètre MVP  
dashboard temps réel, API, notifications, signature électronique, multi-tenant.

---

## 12. plan de mise en œuvre

Semaine 1 setup  
[ ] repo GitHub privé  
[ ] docker local  
[ ] mkdocs base + strict  
[ ] template v3.1 avec 31 `<!-- DINUM -->`  
[ ] script scoring testé  
[ ] import module SIRCOM

Semaine 2 automatisation  
[ ] GitHub Actions ordre corrigé  
[ ] export PDF  
[ ] preview protégée  
[ ] doc contributeur 1 page

Semaine 3 onboarding services  
[ ] modules vides avec front-matter  
[ ] formation Git basique 2 h  
[ ] premiers contenus

Semaine 4 production  
[ ] review contenus  
[ ] validation Yves  
[ ] tag v1.0.0  
[ ] publication

---
## 12 bis. release en 5 étapes

But  
Tagger, tracer, et archiver proprement chaque version, PDF inclus.

Étapes

1. Préparer la version
    - Mettre à jour `docs/index.md` section « Dernière mise à jour » et le numéro de version en tête du PRD
    - Vérifier la synthèse générée par CI
        
2. Changelog bref
    - Fichier `CHANGELOG.md` avec rubrique `## vX.Y.Z – AAAA-MM-JJ`
    - Trois puces maximum: ajout, correction, breaking
        
3. Taguer
    `git tag -a vX.Y.Z -m "Release SPAN SG vX.Y.Z" git push origin vX.Y.Z`
    
4. Construire et récupérer artefacts
    - Le pipeline `build` publie `site/` et `exports/span-sg.pdf` en artefacts

5. Créer la release GitHub

    - Titre: `SPAN SG vX.Y.Z`
    - Joindre `exports/span-sg.pdf` comme pièce jointe d’archive
    - Lier le changelog et les points GO/NO-GO

Critères d’acceptation

- Tag présent, release publiée, PDF d’archive attaché, changelog bref existant.

---

## 13. contacts

|Rôle|Nom|GitHub|
|---|---|---|
|Owner|Alexandra|@alexandra|
|Validateur|Bertrand|@bertrand|
|Validateur|Alex|@alex|
|Sponsor|Yves|-|

---

## décision go/no-go

-  architecture v3.1 validée
-  repository créé
-  accès configurés
-  template checklist approuvé
-  script scoring testé
-  planning accepté

_PRD v3.1 avec checklist officielle, 30 septembre 2025_  
_Principe: simple, fonctionnel, efficace, conforme_

---

## prochaines étapes critiques

1. créer le repo GitHub
2. mapper les SPAN existants sur la checklist et taguer `<!-- DINUM -->`
3. tester le workflow avec un module pilote
4. former Alexandra sur MkDocs si nécessaire


Souhaites-tu que je te fournisse le fichier `_template.md` déjà balisé avec les 31 `<!-- DINUM -->` et la version finale de `calculate_scores.py` et `build.yml` prêts à coller dans le repo?