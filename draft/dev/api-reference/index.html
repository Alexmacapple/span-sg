<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://alexmacapple.github.io/span-sg/dev/api-reference/" rel="canonical"/>
<link href="../../img/favicon.ico" rel="shortcut icon"/>
<title>API Reference - Scripts et Hooks</title>
<link href="../../css/theme.css" rel="stylesheet"/>
<link href="../../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "API Reference - Scripts et Hooks";
        var mkdocs_page_input_path = "dev/api-reference.md";
        var mkdocs_page_url = "/span-sg/dev/api-reference/";
      </script>
<!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<link href="../../../exports/span-sg.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../..">
</a><div role="search">
<form action="../../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../..">SPAN (SG)</a>
</li>
</ul>
<p class="caption"><span class="caption-text">SPAN (services)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/bgs/">BGS</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/safi/">SAFI</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/siep/">SIEP</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/sircom/">SIRCOM</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/snum/">SNUM</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/srh/">SRH</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../synthese/">Synthèse</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../processus/">Processus</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/">Guide contributeur</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev-local/">Développement local</a>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="" href="https://github.com/Alexmacapple/span-sg">Code source GitHub</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../.."></a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Docs" class="icon icon-home" href="../.."></a></li>
<li class="breadcrumb-item active">API Reference - Scripts et Hooks</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/Alexmacapple/span-sg/edit/master/docs/dev/api-reference.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="api-reference-scripts-et-hooks">API Reference - Scripts et Hooks</h1>
<p>Documentation technique complète des scripts Python et hooks MkDocs du projet SPAN SG.</p>
<p>Version: 1.0.1-dsfr
Dernière mise à jour: 2025-10-11</p>
<hr/>
<h2 id="scripts-production">Scripts Production</h2>
<h3 id="calculate_scorespy">calculate_scores.py</h3>
<p>Calcul automatique des scores SPAN par module (31 points DINUM).</p>
<p><strong>Localisation:</strong> <code>scripts/calculate_scores.py</code>
<strong>Coverage:</strong> 100%
<strong>Tests:</strong> <code>scripts/test_calculate_scores*.py</code> (26 tests)</p>
<p><strong>Usage:</strong></p>
<pre><code class="language-bash">python scripts/calculate_scores.py
# Génère: docs/synthese.md
# Exit code: 0 (succès) ou 2 (erreur périmètre)
</code></pre>
<p><strong>Workflow CI:</strong></p>
<pre><code class="language-yaml">- name: Calculate SPAN scores
  run: python scripts/calculate_scores.py
</code></pre>
<hr/>
<h4 id="constantes">Constantes</h4>
<pre><code class="language-python">CHECK_TAG = "DINUM"                    # Tag marqueur des 31 points officiels
FENCE_RE = re.compile(r"```.*?```", re.S)  # Regex code fences
BOX_RE = re.compile(r"- \[(x|X| )\].*?&lt;!--\s*DINUM\s*--&gt;")  # Regex checkboxes
</code></pre>
<hr/>
<h4 id="load_textp-path-str"><code>load_text(p: Path) -&gt; str</code></h4>
<p>Charge le contenu d'un module Markdown en excluant les blocs de code.</p>
<p><strong>Args:</strong>
- <code>p</code> (Path): Chemin vers fichier .md du module</p>
<p><strong>Returns:</strong>
- <code>str</code>: Contenu Markdown sans code fences (<code>...</code>)</p>
<p><strong>Justification:</strong>
Les blocs de code peuvent contenir des checkboxes exemples qui ne doivent pas être comptées.</p>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from pathlib import Path
from scripts.calculate_scores import load_text

content = load_text(Path("docs/modules/sircom.md"))
# Returns: Markdown sans code blocks
</code></pre>
<p><strong>Tests:</strong>
- <code>test_removes_code_fences()</code>: Vérifie exclusion code blocks</p>
<hr/>
<h4 id="score_modulep-path-tupleint-int"><code>score_module(p: Path) -&gt; tuple[int, int]</code></h4>
<p>Compte les cases cochées parmi les 31 points DINUM d'un module.</p>
<p><strong>Args:</strong>
- <code>p</code> (Path): Chemin vers module (docs/modules/*.md)</p>
<p><strong>Returns:</strong>
- <code>tuple[int, int]</code>: (checked, total)
  - <code>checked</code>: Nombre de cases cochées <code>[x]</code>
  - <code>total</code>: Nombre total de cases avec <code>&lt;!-- DINUM --&gt;</code></p>
<p><strong>Validation:</strong>
- <code>total</code> doit être 0 (module vide) ou 31 (périmètre complet)
- Sinon erreur détectée par <code>generate_summary()</code></p>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from pathlib import Path
from scripts.calculate_scores import score_module

checked, total = score_module(Path("docs/modules/sircom.md"))
# Returns: (24, 31) pour SIRCOM actuel
# Pourcentage: 24/31 = 77.4%
</code></pre>
<p><strong>Format attendu dans .md:</strong></p>
<pre><code class="language-markdown">- [x] Point validé &lt;!-- DINUM --&gt;
- [ ] Point non validé &lt;!-- DINUM --&gt;
</code></pre>
<p><strong>Tests:</strong>
- <code>test_module_0_of_31()</code>: Module vide
- <code>test_module_6_of_31_sircom()</code>: Module partiel
- <code>test_module_31_of_31()</code>: Module complet
- <code>test_module_invalid_30_points()</code>: Erreur périmètre</p>
<hr/>
<h4 id="get_validation_statusp-path-str"><code>get_validation_status(p: Path) -&gt; str</code></h4>
<p>Extrait le statut de validation depuis le front-matter YAML du module.</p>
<p><strong>Args:</strong>
- <code>p</code> (Path): Chemin vers module</p>
<p><strong>Returns:</strong>
- <code>str</code>: Statut traduit
  - <code>"Validé"</code> si <code>validation_status: validated</code>
  - <code>"En cours"</code> si <code>validation_status: in_progress</code>
  - <code>"Brouillon"</code> si <code>validation_status: draft</code> ou absent</p>
<p><strong>Front-matter attendu:</strong></p>
<pre><code class="language-yaml">---
service: SIRCOM
referent: "Pôle web"
updated: "2025-10-02"
validation_status: validated  # validated | in_progress | draft
---
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from pathlib import Path
from scripts.calculate_scores import get_validation_status

status = get_validation_status(Path("docs/modules/sircom.md"))
# Returns: "Validé"
</code></pre>
<p><strong>Tests:</strong>
- <code>test_validated_status_returns_valide()</code>
- <code>test_in_progress_status_returns_en_cours()</code>
- <code>test_draft_status_returns_brouillon()</code>
- <code>test_missing_validation_status_returns_brouillon()</code></p>
<hr/>
<h4 id="generate_summary-int"><code>generate_summary() -&gt; int</code></h4>
<p>Point d'entrée principal. Génère <code>docs/synthese.md</code> avec tableau HTML DSFR des scores.</p>
<p><strong>Returns:</strong>
- <code>int</code>: Exit code
  - <code>0</code>: Succès, synthèse générée
  - <code>2</code>: Erreur périmètre (module avec ≠ 0 ou 31 points)</p>
<p><strong>Processus:</strong>
1. Scanne tous fichiers <code>docs/modules/*.md</code> (sauf <code>_template.md</code>)
2. Pour chaque module:
   - Compte cases cochées avec <code>score_module()</code>
   - Extrait statut avec <code>get_validation_status()</code>
   - Calcule pourcentage et statut global
3. Génère tableau HTML DSFR dans <code>docs/synthese.md</code>
4. Valide périmètre (0 ou 31 points par module)</p>
<p><strong>Format output (HTML DSFR):</strong></p>
<pre><code class="language-html">&lt;div class="fr-table fr-table--bordered" id="table-synthese-span"&gt;
    &lt;table id="table-span-modules"&gt;
        &lt;tr&gt;
            &lt;td&gt;SIRCOM&lt;/td&gt;
            &lt;td&gt;24/31 (77.4%)&lt;/td&gt;
            &lt;td&gt;Conforme&lt;/td&gt;
            &lt;td&gt;Validé&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;strong&gt;TOTAL&lt;/strong&gt;&lt;/td&gt;
            &lt;td&gt;&lt;strong&gt;24/186 (12.9%)&lt;/strong&gt;&lt;/td&gt;
            ...
        &lt;/tr&gt;
    &lt;/table&gt;
&lt;/div&gt;
</code></pre>
<p><strong>Statuts calculés:</strong>
- <code>"Conforme"</code>: ≥ 75% (≥ 24/31)
- <code>"En cours"</code>: &gt; 0% et &lt; 75%
- <code>"Non renseigné"</code>: 0%</p>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from scripts.calculate_scores import generate_summary

exit_code = generate_summary()
# Génère: docs/synthese.md
# Returns: 0 (succès) ou 2 (erreur)
</code></pre>
<p><strong>Validation périmètre:</strong></p>
<pre><code class="language-python"># Erreur affichée si total ≠ 0 ou 31
Erreurs de périmètre:
 - sircom.md: 30 points tagués &lt;!-- DINUM --&gt; (attendu 31 ou 0)
</code></pre>
<p><strong>Tests:</strong>
- <code>test_valid_modules_exit_0()</code>: Modules valides (0 ou 31)
- <code>test_invalid_module_exit_2()</code>: Module invalide (30 points)
- <code>test_status_calculation[...]</code>: 6 scénarios calcul statut</p>
<hr/>
<h3 id="enrich_pdf_metadatapy">enrich_pdf_metadata.py</h3>
<p>Enrichit les métadonnées XMP/PDF pour conformité accessibilité RGAA.</p>
<p><strong>Localisation:</strong> <code>scripts/enrich_pdf_metadata.py</code>
<strong>Coverage:</strong> 78%
<strong>Tests:</strong> <code>scripts/test_enrich_pdf*.py</code> (7 tests)
<strong>Dépendances:</strong> <code>pikepdf&gt;=8.0.0</code></p>
<p><strong>Usage:</strong></p>
<pre><code class="language-bash"># Modifier sur place (défaut)
python scripts/enrich_pdf_metadata.py exports/span-sg.pdf

# Input/output explicites
python scripts/enrich_pdf_metadata.py input.pdf output.pdf
</code></pre>
<p><strong>Workflow CI:</strong></p>
<pre><code class="language-yaml">- name: Enrich PDF metadata
  run: python scripts/enrich_pdf_metadata.py exports/span-sg.pdf
</code></pre>
<hr/>
<h4 id="enrich_pdf_metadatainput_path-path-output_path-path-none-none"><code>enrich_pdf_metadata(input_path: Path, output_path: Path = None) -&gt; None</code></h4>
<p>Ajoute métadonnées Dublin Core et XMP au PDF généré par MkDocs.</p>
<p><strong>Args:</strong>
- <code>input_path</code> (Path): Chemin vers PDF source
- <code>output_path</code> (Path, optional): Chemin vers PDF enrichi
  - Si <code>None</code>: Modification sur place (défaut)</p>
<p><strong>Returns:</strong>
- <code>None</code></p>
<p><strong>Raises:</strong>
- <code>FileNotFoundError</code>: Si <code>input_path</code> n'existe pas
- <code>ImportError</code>: Si <code>pikepdf</code> non installé
- <code>Exception</code>: Si erreur lors du traitement PDF (corrompu, etc.)</p>
<p><strong>Métadonnées ajoutées:</strong></p>
<p><strong>Dublin Core (DC):</strong></p>
<pre><code class="language-python">meta["dc:title"] = "SPAN SG"
meta["dc:language"] = "fr-FR"
meta["dc:creator"] = ["Secrétariat Général"]
meta["dc:subject"] = "Schéma Pluriannuel d'Accessibilité Numérique"
meta["dc:description"] = "Plan d'accessibilité numérique du SG 2025-2027..."
</code></pre>
<p><strong>PDF spécifiques:</strong></p>
<pre><code class="language-python">meta["pdf:Keywords"] = "SPAN, accessibilité, SG, numérique, RGAA, DINUM"
meta["pdf:Producer"] = "MkDocs Material + mkdocs-with-pdf + pikepdf"
</code></pre>
<p><strong>XMP:</strong></p>
<pre><code class="language-python">meta["xmp:CreatorTool"] = "MkDocs Material 9.x"
meta["xmp:CreateDate"] = datetime.now(timezone.utc).isoformat()
meta["xmp:MetadataDate"] = datetime.now(timezone.utc).isoformat()
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-python">from pathlib import Path
from scripts.enrich_pdf_metadata import enrich_pdf_metadata

# Modification sur place
enrich_pdf_metadata(Path("exports/span-sg.pdf"))

# Avec output distinct
enrich_pdf_metadata(
    Path("exports/span-sg.pdf"),
    Path("exports/span-sg-enriched.pdf")
)
</code></pre>
<p><strong>Gestion erreurs:</strong></p>
<pre><code class="language-python"># 1. Import manquant
try:
    import pikepdf
except ImportError:
    print("❌ Erreur: pikepdf non installé")
    sys.exit(1)

# 2. Fichier inexistant
if not input_path.exists():
    print(f"❌ Fichier introuvable: {input_path}")
    sys.exit(1)

# 3. Erreur traitement
try:
    with pikepdf.open(input_path) as pdf:
        # ... traitement
except Exception as e:
    print(f"❌ Erreur lors de l'enrichissement: {e}")
    sys.exit(1)
</code></pre>
<p><strong>Tests:</strong>
- <code>test_file_not_found_exits_1()</code>: Fichier inexistant
- <code>test_enrich_valid_pdf_adds_metadata()</code>: Enrichissement réussi
- <code>test_corrupted_pdf_raises_exception()</code>: PDF corrompu
- <code>test_pdf_save_error_caught()</code>: Erreur sauvegarde</p>
<hr/>
<h2 id="hooks-mkdocs">Hooks MkDocs</h2>
<h3 id="dsfr_table_wrapperpy">dsfr_table_wrapper.py</h3>
<p>Wrappe automatiquement les <code>&lt;table&gt;</code> avec <code>&lt;div class="fr-table"&gt;</code> pour conformité DSFR.</p>
<p><strong>Localisation:</strong> <code>hooks/dsfr_table_wrapper.py</code>
<strong>Coverage:</strong> 100%
<strong>Tests:</strong> <code>tests/test_hooks_dsfr_table_wrapper.py</code> (7 tests)</p>
<p><strong>Hook MkDocs:</strong> <code>on_page_content</code></p>
<p><strong>Usage automatique:</strong></p>
<pre><code class="language-yaml"># mkdocs-dsfr.yml
hooks:
  - hooks/dsfr_table_wrapper.py
</code></pre>
<hr/>
<h4 id="on_page_contenthtml-str-page-page-config-config-files-files-str"><code>on_page_content(html: str, page: "Page", config: "Config", files: "Files") -&gt; str</code></h4>
<p>Hook appelé après conversion Markdown → HTML. Wrappe toutes les tables.</p>
<p><strong>Args:</strong>
- <code>html</code> (str): Contenu HTML de la page après conversion Markdown
- <code>page</code> (Page): Instance MkDocs Page (non utilisé)
- <code>config</code> (Config): Configuration MkDocs (non utilisé)
- <code>files</code> (Files): Collection fichiers MkDocs (non utilisé)</p>
<p><strong>Returns:</strong>
- <code>str</code>: HTML modifié avec toutes les tables wrappées dans <code>&lt;div class="fr-table"&gt;</code></p>
<p><strong>Comportement:</strong>
- Détecte toutes balises <code>&lt;table&gt;</code> (avec ou sans attributs id, class, etc.)
- Wrappe avec <code>&lt;div class="fr-table"&gt;\n{table}\n&lt;/div&gt;</code>
- Évite double-wrapping avec lookahead négatif regex</p>
<p><strong>Regex utilisée:</strong></p>
<pre><code class="language-python">pattern = r'(?&lt;!&lt;div class="fr-table"&gt;)\s*(&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;)'
#         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Lookahead négatif (pas déjà wrappé)
#                                        ^^^^^^^^ Match attributs optionnels
</code></pre>
<p><strong>Example transformation:</strong></p>
<pre><code class="language-html">&lt;!-- INPUT --&gt;
&lt;table id="my-table" class="custom"&gt;
    &lt;tr&gt;&lt;td&gt;Data&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

&lt;!-- OUTPUT --&gt;
&lt;div class="fr-table"&gt;
&lt;table id="my-table" class="custom"&gt;
    &lt;tr&gt;&lt;td&gt;Data&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;
</code></pre>
<p><strong>Justification:</strong>
Le thème mkdocs-dsfr supprime les divs HTML lors du preprocessing Markdown.
Ce hook post-traite le HTML pour réinjecter le wrapper DSFR requis pour :
- Accessibilité RGAA (navigation clavier)
- Responsive design (scroll horizontal mobile)</p>
<p><strong>Tests coverage 100%:</strong>
- <code>test_wrap_simple_table()</code>: Table basique
- <code>test_wrap_multiple_tables()</code>: Plusieurs tables (wrappées individuellement)
- <code>test_already_wrapped_table()</code>: Pas de double-wrapping
- <code>test_no_table()</code>: HTML sans table (inchangé)
- <code>test_complex_table_multiline()</code>: Table avec thead/tbody
- <code>test_table_with_attributes()</code>: Table avec id/class préservés
- <code>test_malformed_html_graceful()</code>: HTML malformé (graceful fallback)</p>
<p><strong>Bug historique corrigé (2025-10-11):</strong></p>
<pre><code class="language-python"># AVANT (bug)
pattern = r'&lt;table&gt;.*?&lt;/table&gt;'  # ❌ Ne matche pas &lt;table id="..."&gt;

# APRÈS (fixé)
pattern = r'&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;'  # ✅ Matche tous attributs
</code></pre>
<hr/>
<h3 id="title_cleanerpy">title_cleaner.py</h3>
<p>Nettoie les titres HTML redondants quand <code>site_name</code> est vide (thème DSFR).</p>
<p><strong>Localisation:</strong> <code>hooks/title_cleaner.py</code>
<strong>Coverage:</strong> 100%
<strong>Tests:</strong> <code>tests/test_hooks_title_cleaner.py</code> (6 tests)</p>
<p><strong>Hook MkDocs:</strong> <code>on_post_page</code></p>
<p><strong>Usage automatique:</strong></p>
<pre><code class="language-yaml"># mkdocs-dsfr.yml
hooks:
  - hooks/title_cleaner.py
</code></pre>
<hr/>
<h4 id="on_post_pageoutput-str-page-page-config-config-str"><code>on_post_page(output: str, page: "Page", config: "Config") -&gt; str</code></h4>
<p>Hook appelé après génération HTML complète de la page. Nettoie titres.</p>
<p><strong>Args:</strong>
- <code>output</code> (str): HTML complet de la page après génération
- <code>page</code> (Page): Instance MkDocs Page (non utilisé)
- <code>config</code> (Config): Configuration MkDocs (non utilisé)</p>
<p><strong>Returns:</strong>
- <code>str</code>: HTML modifié avec titre nettoyé</p>
<p><strong>Comportement:</strong>
Transforme <code>&lt;title&gt;Page  -  &lt;/title&gt;</code> en <code>&lt;title&gt;Page&lt;/title&gt;</code></p>
<p><strong>Regex utilisée:</strong></p>
<pre><code class="language-python">pattern = r"&lt;title&gt;\s*(.*?)\s*-\s*\s*&lt;/title&gt;"
replacement = r"&lt;title&gt;\1&lt;/title&gt;"
</code></pre>
<p><strong>Example transformation:</strong></p>
<pre><code class="language-html">&lt;!-- INPUT --&gt;
&lt;title&gt;
        SPAN (SG)
        -

    &lt;/title&gt;

&lt;!-- OUTPUT --&gt;
&lt;title&gt;SPAN (SG)&lt;/title&gt;
</code></pre>
<p><strong>Justification:</strong>
Lorsque <code>site_name</code> est vide dans <code>mkdocs.yml</code>, MkDocs génère des titres avec tirets orphelins et espaces superflus. Ce hook nettoie ces artefacts pour améliorer :
- SEO (titres propres indexés par moteurs recherche)
- Accessibilité (lecteurs d'écran lisent titres propres)</p>
<p><strong>Config déclencheuse:</strong></p>
<pre><code class="language-yaml"># mkdocs-dsfr.yml
site_name: ""  # Vide → titres avec tirets orphelins
</code></pre>
<p><strong>Tests coverage 100%:</strong>
- <code>test_clean_title_with_dash_and_spaces()</code>: Titre multiligne avec tiret
- <code>test_clean_title_simple_dash()</code>: Tiret simple
- <code>test_clean_title_without_dash()</code>: Titre sans tiret (inchangé)
- <code>test_no_title_tag()</code>: HTML sans title (inchangé)
- <code>test_title_with_rich_content()</code>: Contenu riche préservé
- <code>test_multiple_titles()</code>: Plusieurs titres nettoyés</p>
<hr/>
<h2 id="bonnes-pratiques">Bonnes pratiques</h2>
<h3 id="type-hints-modernes-pep-563">Type hints modernes (PEP 563)</h3>
<pre><code class="language-python">from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from mkdocs.structure.pages import Page
    from mkdocs.config import Config

def on_page_content(html: str, page: "Page", config: "Config", files) -&gt; str:
    # TYPE_CHECKING = False en runtime (pas d'import réel)
    # Mais IDE/mypy voient les types
    pass
</code></pre>
<h3 id="gestion-erreurs-robuste">Gestion erreurs robuste</h3>
<pre><code class="language-python"># 3 niveaux (enrich_pdf_metadata.py)
try:
    import pikepdf  # 1. Import
except ImportError:
    sys.exit(1)

if not path.exists():  # 2. Validation input
    sys.exit(1)

try:
    # ... traitement  # 3. Erreurs runtime
except Exception as e:
    sys.exit(1)
</code></pre>
<h3 id="tests-exhaustifs">Tests exhaustifs</h3>
<pre><code class="language-python"># Minimum 5 scénarios par fonction
def test_nominal():        # Cas nominal
def test_edge_case():      # Cas limite
def test_empty_input():    # Input vide
def test_invalid_input():  # Input invalide
def test_multiple():       # Plusieurs éléments
</code></pre>
<hr/>
<h2 id="references">Références</h2>
<p><strong>Tests:</strong>
- <code>scripts/test_calculate_scores*.py</code>: 26 tests, 100% coverage
- <code>scripts/test_enrich_pdf*.py</code>: 7 tests, 78% coverage
- <code>tests/test_hooks*.py</code>: 13 tests, 100% coverage</p>
<p><strong>Standards:</strong>
- PEP 8: Style guide Python
- PEP 257: Docstring conventions
- PEP 563: Postponed evaluation annotations (TYPE_CHECKING)
- Black: Code formatter (line-length 88)
- Ruff: Linter (select E,W,F,I,N)</p>
<p><strong>Coverage global ciblé:</strong> 92% (seuil 89%+)</p>
</div>
</div><footer>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/Alexmacapple/span-sg" style="color: #fcfcfc"> GitHub</a>
</span>
</span>
</div>
<script src="../../js/jquery-3.6.0.min.js"></script>
<script>var base_url = "../..";</script>
<script src="../../js/theme_extra.js"></script>
<script src="../../js/theme.js"></script>
<script src="../../search/main.js"></script>
<script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>
</body>
</html>
