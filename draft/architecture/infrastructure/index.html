
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://alexmacapple.github.io/span-sg/architecture/infrastructure/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Architecture Infrastructure - Runtime et Déploiement - SPAN SG</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture-infrastructure-runtime-et-deploiement" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../.." title="SPAN SG" class="md-header__button md-logo" aria-label="SPAN SG" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SPAN SG
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture Infrastructure - Runtime et Déploiement
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Alexmacapple/span-sg" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  SPAN (SG)

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules/bgs/" class="md-tabs__link">
          
  
  
  SPAN (services)

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../synthese/" class="md-tabs__link">
        
  
  
    
  
  Synthèse

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../processus/" class="md-tabs__link">
        
  
  
    
  
  Processus

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Guide contributeur

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../dev-local/" class="md-tabs__link">
        
  
  
    
  
  Développement local

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SPAN SG" class="md-nav__button md-logo" aria-label="SPAN SG" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SPAN SG
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Alexmacapple/span-sg" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SPAN (SG)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    SPAN (services)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            SPAN (services)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/bgs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BGS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/safi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SAFI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/siep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIEP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sircom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIRCOM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/snum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SNUM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/srh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SRH
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../synthese/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Synthèse
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Processus
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guide contributeur
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev-local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Développement local
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="architecture-infrastructure-runtime-et-deploiement">Architecture Infrastructure - Runtime et Déploiement<a class="headerlink" href="#architecture-infrastructure-runtime-et-deploiement" title="Permanent link">&para;</a></h1>
<p>Documentation détaillée de l'infrastructure runtime, ressources système et architecture de déploiement SPAN SG.</p>
<p>Version: 1.2.0-environments
Dernière mise à jour: 2025-10-22</p>
<hr />
<h2 id="1-vue-densemble-infrastructure">1. Vue d'ensemble Infrastructure<a class="headerlink" href="#1-vue-densemble-infrastructure" title="Permanent link">&para;</a></h2>
<p>Architecture cloud-native basée sur GitHub Actions et GitHub Pages.</p>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;Developer Workstation&quot;
        DEV[fa:fa-laptop Poste développeur&lt;br/&gt;macOS/Linux/Windows]
        DOCKER[fa:fa-docker Docker Desktop&lt;br/&gt;mkdocs-dsfr:latest]
        VSCODE[fa:fa-code VS Code&lt;br/&gt;Extension MkDocs]
    end

    subgraph &quot;GitHub Cloud&quot;
        direction TB
        subgraph &quot;GitHub Repository&quot;
            REPO[fa:fa-code span-sg&lt;br/&gt;Git Repository]
            ISSUES[fa:fa-bug Issues&lt;br/&gt;Suivi bugs]
            PR[fa:fa-code-branch Pull Requests&lt;br/&gt;Review process]
        end

        subgraph &quot;GitHub Actions Runners&quot;
            RUNNER[fa:fa-server ubuntu-latest&lt;br/&gt;8 vCPU, 14 GB RAM]
            CACHE[fa:fa-hdd Build Cache&lt;br/&gt;Docker layers + pip]
        end

        subgraph &quot;GitHub Pages&quot;
            GHP[fa:fa-globe GitHub Pages&lt;br/&gt;CDN CloudFlare]
            DRAFT[fa:fa-folder /draft/&lt;br/&gt;Preview org-only]
            PROD[fa:fa-folder / racine&lt;br/&gt;Production public]
        end

        subgraph &quot;Artifacts Storage&quot;
            ART[fa:fa-archive Artifacts&lt;br/&gt;Retention 30-90j]
        end
    end

    subgraph &quot;External Services&quot;
        DINUM[fa:fa-landmark DINUM&lt;br/&gt;Référentiel RGAA]
        NPM[fa:fa-cube npm registry&lt;br/&gt;Dependencies JS]
        PYPI[fa:fa-cube PyPI&lt;br/&gt;Dependencies Python]
    end

    DEV --&gt;|git push| REPO
    DEV --&gt;|docker-compose up| DOCKER

    REPO --&gt;|Webhook| RUNNER
    RUNNER --&gt;|Cache Docker| CACHE
    RUNNER --&gt;|Upload| ART
    RUNNER --&gt;|Deploy| GHP

    GHP --&gt; DRAFT
    GHP --&gt; PROD

    RUNNER --&gt;|Download deps| NPM
    RUNNER --&gt;|pip install| PYPI

    DEV --&gt;|Référence| DINUM

    style RUNNER fill:#b5f5ec,stroke:#13c2c2,stroke-width:3px
    style GHP fill:#b7eb8f,stroke:#52c41a,stroke-width:3px
    style REPO fill:#ffc9c9,stroke:#ff4d4f,stroke-width:2px
</code></pre>
<hr />
<h2 id="2-cicd-runner-infrastructure">2. CI/CD Runner Infrastructure<a class="headerlink" href="#2-cicd-runner-infrastructure" title="Permanent link">&para;</a></h2>
<h3 id="github-actions-runner-specs">GitHub Actions Runner Specs<a class="headerlink" href="#github-actions-runner-specs" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">Runner: ubuntu-latest (Ubuntu 22.04 LTS)
vCPU: 8 cores
RAM: 14 GB
Disk: 14 GB SSD
Network: 1 Gbps
Runtime: ~15min (draft), ~20min (main)
</code></pre>
<h3 id="software-stack-runner">Software Stack Runner<a class="headerlink" href="#software-stack-runner" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;OS Layer&quot;
        UBUNTU[Ubuntu 22.04 LTS&lt;br/&gt;Kernel 5.15+]
    end

    subgraph &quot;Runtime Layer&quot;
        PYTHON[Python 3.11.13&lt;br/&gt;CPython]
        NODE[Node.js 20 LTS&lt;br/&gt;npm 10]
        DOCKER[Docker 24.x&lt;br/&gt;Buildx]
    end

    subgraph &quot;Build Tools&quot;
        PIP[pip 24.3.1&lt;br/&gt;Package installer]
        GIT[Git 2.47&lt;br/&gt;Version control]
        APT[apt-get&lt;br/&gt;System packages]
    end

    subgraph &quot;System Libraries&quot;
        PANGO[libpango-1.0&lt;br/&gt;Text rendering]
        CAIRO[libcairo2&lt;br/&gt;Vector graphics]
        GDK[libgdk-pixbuf&lt;br/&gt;Image loading]
        HARFBUZZ[libharfbuzz&lt;br/&gt;Text shaping]
    end

    subgraph &quot;Python Packages&quot;
        MKDOCS[mkdocs==1.6.1&lt;br/&gt;Site generator]
        DSFR[mkdocs-dsfr==0.17&lt;br/&gt;Theme DSFR]
        WEASY[weasyprint==62.3&lt;br/&gt;PDF generator]
        PYTEST[pytest==8.3.4&lt;br/&gt;Test framework]
    end

    UBUNTU --&gt; PYTHON
    UBUNTU --&gt; NODE
    UBUNTU --&gt; DOCKER

    PYTHON --&gt; PIP
    UBUNTU --&gt; GIT
    UBUNTU --&gt; APT

    APT --&gt; PANGO
    APT --&gt; CAIRO
    APT --&gt; GDK
    APT --&gt; HARFBUZZ

    PIP --&gt; MKDOCS
    PIP --&gt; DSFR
    PIP --&gt; WEASY
    PIP --&gt; PYTEST

    WEASY -.-&gt;|requires| PANGO
    WEASY -.-&gt;|requires| CAIRO

    style PYTHON fill:#91d5ff,stroke:#1890ff,stroke-width:2px
    style MKDOCS fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
    style WEASY fill:#ffc9c9,stroke:#ff4d4f,stroke-width:2px
</code></pre>
<hr />
<h2 id="3-build-pipeline-detaille">3. Build Pipeline Détaillé<a class="headerlink" href="#3-build-pipeline-detaille" title="Permanent link">&para;</a></h2>
<h3 id="phases-de-build">Phases de Build<a class="headerlink" href="#phases-de-build" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">graph LR
    subgraph &quot;Phase 1: Setup (30s)&quot;
        A[Checkout code]
        B[Setup Python 3.11]
        C[Install deps DSFR]
        D[Install deps dev]
    end

    subgraph &quot;Phase 2: Quality (60s)&quot;
        E[Black formatter]
        F[Ruff linter]
        G[Pytest 33 tests]
        H[Coverage 89%+]
    end

    subgraph &quot;Phase 3: Security (45s)&quot;
        I[Bandit scan]
        J[Safety CVE check]
        K[Upload reports]
    end

    subgraph &quot;Phase 4: Build (90s)&quot;
        L[Calculate scores]
        M[Build HTML DSFR]
        N[Verify DSFR theme]
        O[Generate PDF]
        P[Enrich metadata]
        Q[Validate qpdf]
    end

    subgraph &quot;Phase 5: E2E (300s main)&quot;
        R[Docker Buildx]
        S[Run 9 scenarios]
        T[Upload E2E report]
    end

    subgraph &quot;Phase 6: Deploy Staging (60s)&quot;
        U[Clone gh-pages]
        V[Deploy to /draft/]
        W[Push staging]
    end

    subgraph &quot;Phase 7: Deploy Production (60s)&quot;
        X[Pull staging changes]
        Y[Deploy to / root]
        Z[Push production]
    end

    A --&gt; B --&gt; C --&gt; D
    D --&gt; E --&gt; F --&gt; G --&gt; H
    H --&gt; I --&gt; J --&gt; K
    K --&gt; L --&gt; M --&gt; N --&gt; O --&gt; P --&gt; Q
    Q --&gt; R --&gt; S --&gt; T
    T --&gt; U --&gt; V --&gt; W
    W --&gt; X --&gt; Y --&gt; Z

    style Z fill:#b7eb8f,stroke:#52c41a,stroke-width:3px
</code></pre>
<h3 id="temps-dexecution">Temps d'exécution<a class="headerlink" href="#temps-dexecution" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Phase</th>
<th>Push main</th>
<th>Critique</th>
</tr>
</thead>
<tbody>
<tr>
<td>Setup</td>
<td>30s</td>
<td>Non</td>
</tr>
<tr>
<td>Quality</td>
<td>60s</td>
<td>Oui (fail-fast)</td>
</tr>
<tr>
<td>Security</td>
<td>45s</td>
<td>Oui (bloquant)</td>
</tr>
<tr>
<td>Build</td>
<td>90s</td>
<td>Oui (strict mode)</td>
</tr>
<tr>
<td>E2E</td>
<td>300s</td>
<td>Oui (main only)</td>
</tr>
<tr>
<td>Deploy Staging</td>
<td>60s</td>
<td>Non</td>
</tr>
<tr>
<td>Deploy Production</td>
<td>60s</td>
<td>Non (séquentiel)</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>~11min</strong></td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Note: Déploiement séquentiel depuis v1.2.0 (staging puis production) pour éviter conflits gh-pages.</p>
<hr />
<h2 id="4-caching-strategy">4. Caching Strategy<a class="headerlink" href="#4-caching-strategy" title="Permanent link">&para;</a></h2>
<h3 id="docker-layer-cache">Docker Layer Cache<a class="headerlink" href="#docker-layer-cache" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">Cache key: ${{ runner.os }}-buildx-${{ hashFiles('Dockerfile.mkdocs-test') }}
Storage: /tmp/.buildx-cache
Size: ~500 MB
Hit rate: 95% (runs consécutifs)
Miss penalty: +2min build
</code></pre>
<h3 id="pip-dependencies-cache">Pip Dependencies Cache<a class="headerlink" href="#pip-dependencies-cache" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">Cache key: ${{ runner.os }}-pip-${{ hashFiles('requirements-dsfr.txt') }}
Storage: ~/.cache/pip
Size: ~200 MB
Hit rate: 98%
Miss penalty: +30s install
</code></pre>
<h3 id="build-cache-effectiveness">Build Cache Effectiveness<a class="headerlink" href="#build-cache-effectiveness" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">pie title &quot;Cache Hit Rate (30 derniers builds)&quot;
    &quot;Cache Hit (13min)&quot; : 85
    &quot;Cache Miss (15min)&quot; : 15
</code></pre>
<hr />
<h2 id="5-deploiement-github-pages">5. Déploiement GitHub Pages<a class="headerlink" href="#5-deploiement-github-pages" title="Permanent link">&para;</a></h2>
<h3 id="architecture-cdn">Architecture CDN<a class="headerlink" href="#architecture-cdn" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;GitHub Pages Infrastructure&quot;
        GHP[GitHub Pages&lt;br/&gt;Static hosting]
        CF[CloudFlare CDN&lt;br/&gt;Global edge network]
    end

    subgraph &quot;Edge Locations&quot;
        EU[Europe&lt;br/&gt;Frankfurt, Paris]
        US[USA&lt;br/&gt;Virginia, California]
        ASIA[Asia&lt;br/&gt;Singapore, Tokyo]
    end

    subgraph &quot;Content&quot;
        HTML[site/*.html&lt;br/&gt;~2 MB]
        CSS[assets/*.css&lt;br/&gt;~500 KB]
        JS[assets/*.js&lt;br/&gt;~300 KB]
        PDF[exports/*.pdf&lt;br/&gt;~8 MB]
    end

    GHP --&gt; CF
    CF --&gt; EU
    CF --&gt; US
    CF --&gt; ASIA

    HTML --&gt; GHP
    CSS --&gt; GHP
    JS --&gt; GHP
    PDF --&gt; GHP

    style CF fill:#ffec3d,stroke:#faad14,stroke-width:2px
    style GHP fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
</code></pre>
<h3 id="strategie-deploiement-avec-github-environments">Stratégie Déploiement avec GitHub Environments<a class="headerlink" href="#strategie-deploiement-avec-github-environments" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">gitGraph
    commit id: &quot;Initial gh-pages&quot;
    branch main
    commit id: &quot;Push main&quot;
    commit id: &quot;CI: build-and-test&quot;
    commit id: &quot;Deploy staging /draft/&quot; tag: &quot;staging&quot;
    commit id: &quot;Deploy production /&quot; tag: &quot;production&quot;
    commit id: &quot;v1.2.0-environments&quot; type: HIGHLIGHT
</code></pre>
<p>Architecture 1-branche + 2 Environments (depuis v1.2.0):
- Branche unique <code>main</code> pour développement
- Environnement <code>staging</code> : déploiement automatique vers /draft/
- Environnement <code>production</code> : déploiement séquentiel vers /</p>
<h3 id="urls-et-acces">URLs et Accès<a class="headerlink" href="#urls-et-acces" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>URL</th>
<th>Environment GitHub</th>
<th>Déploiement gh-pages</th>
<th>Accès</th>
<th>Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>production</td>
<td>gh-pages racine</td>
<td>Public</td>
<td>&lt;100ms</td>
</tr>
<tr>
<td><code>/draft/</code></td>
<td>staging</td>
<td>gh-pages/draft/</td>
<td>Org-only</td>
<td>&lt;100ms</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-ressources-et-quotas">6. Ressources et Quotas<a class="headerlink" href="#6-ressources-et-quotas" title="Permanent link">&para;</a></h2>
<h3 id="github-actions-quotas">GitHub Actions Quotas<a class="headerlink" href="#github-actions-quotas" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">Free tier (public repo):
  - Minutes: Unlimited
  - Concurrent jobs: 20
  - Storage artifacts: 500 MB
  - Retention: 90 jours max

Consommation SPAN SG:
  - Minutes/mois: ~300 min (60 builds × 5 min)
  - Concurrent jobs: 2 (draft + main)
  - Storage: ~50 MB (reports + PDF)
  - Retention: 30-90j selon type
</code></pre>
<h3 id="github-pages-quotas">GitHub Pages Quotas<a class="headerlink" href="#github-pages-quotas" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">Soft limits:
  - Bandwidth: 100 GB/mois
  - Build time: 10 min/build
  - Site size: 1 GB
  - Files: 100k max

Consommation SPAN SG:
  - Bandwidth: &lt;1 GB/mois (usage interne)
  - Build time: 1-2 min (MkDocs)
  - Site size: ~10 MB (HTML + assets)
  - Files: ~200 fichiers
</code></pre>
<hr />
<h2 id="7-monitoring-et-observabilite">7. Monitoring et Observabilité<a class="headerlink" href="#7-monitoring-et-observabilite" title="Permanent link">&para;</a></h2>
<h3 id="metriques-cicd">Métriques CI/CD<a class="headerlink" href="#metriques-cicd" title="Permanent link">&para;</a></h3>
<p>Métriques trackées automatiquement par GitHub Actions :</p>
<pre><code class="language-mermaid">graph LR
    A[Build Duration] --&gt; E[Grafana&lt;br/&gt;Dashboard]
    B[Test Success Rate] --&gt; E
    C[Cache Hit Rate] --&gt; E
    D[Deploy Frequency] --&gt; E

    E --&gt; F[Alertes&lt;br/&gt;Slack/Email]

    style E fill:#ffe7ba,stroke:#fa8c16,stroke-width:2px
</code></pre>
<h3 id="health-checks">Health Checks<a class="headerlink" href="#health-checks" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Check</th>
<th>Fréquence</th>
<th>Seuil alerte</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Build success rate</td>
<td>Par build</td>
<td>&lt;95%</td>
<td>Investigation</td>
</tr>
<tr>
<td>Build duration</td>
<td>Par build</td>
<td>&gt;20min</td>
<td>Optimisation</td>
</tr>
<tr>
<td>Test coverage</td>
<td>Par build</td>
<td>&lt;89%</td>
<td>Fail build</td>
</tr>
<tr>
<td>Deployment success</td>
<td>Par deploy</td>
<td>&lt;100%</td>
<td>Rollback</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="8-disaster-recovery">8. Disaster Recovery<a class="headerlink" href="#8-disaster-recovery" title="Permanent link">&para;</a></h2>
<h3 id="strategie-de-sauvegarde">Stratégie de Sauvegarde<a class="headerlink" href="#strategie-de-sauvegarde" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;Sources&quot;
        REPO[GitHub Repo&lt;br/&gt;Git history]
        PAGES[GitHub Pages&lt;br/&gt;Static site]
        ART[Artifacts&lt;br/&gt;30-90j retention]
    end

    subgraph &quot;Backups&quot;
        GIT_MIRROR[Git Mirror&lt;br/&gt;Backup repo]
        PDF_ARCHIVE[PDF Archive&lt;br/&gt;Releases]
        LOCAL[Local clones&lt;br/&gt;Développeurs]
    end

    subgraph &quot;Recovery Points&quot;
        RTO[RTO: 15 min&lt;br/&gt;Rebuild from main]
        RPO[RPO: 1 commit&lt;br/&gt;Git history]
    end

    REPO -.-&gt;|Mirror| GIT_MIRROR
    PAGES -.-&gt;|Export| PDF_ARCHIVE
    REPO -.-&gt;|Clone| LOCAL

    GIT_MIRROR --&gt; RTO
    PDF_ARCHIVE --&gt; RPO

    style RTO fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
    style RPO fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
</code></pre>
<h3 id="procedure-recovery">Procédure Recovery<a class="headerlink" href="#procedure-recovery" title="Permanent link">&para;</a></h3>
<p>En cas de perte totale GitHub Pages :</p>
<ol>
<li>
<p><strong>Rebuild from Git</strong> (15 min) :
   <code>bash
   git clone https://github.com/Alexmacapple/span-sg.git
   docker compose -f docker-compose-dsfr.yml up -d
   mkdocs build --config-file mkdocs-dsfr.yml
   # Deploy to alternative hosting</code></p>
</li>
<li>
<p><strong>Restore from Releases</strong> (5 min) :
   <code>bash
   gh release download latest --pattern "*.pdf"
   # PDF contient tout le contenu SPAN</code></p>
</li>
<li>
<p><strong>Alternative Hosting</strong> :</p>
</li>
<li>Netlify : <code>netlify deploy --dir=site --prod</code></li>
<li>Vercel : <code>vercel --prod</code></li>
<li>GitLab Pages : Migrate repo + CI</li>
</ol>
<hr />
<h2 id="9-securite-infrastructure">9. Sécurité Infrastructure<a class="headerlink" href="#9-securite-infrastructure" title="Permanent link">&para;</a></h2>
<h3 id="secrets-management">Secrets Management<a class="headerlink" href="#secrets-management" title="Permanent link">&para;</a></h3>
<pre><code class="language-yaml">GitHub Secrets utilisés:
  GITHUB_TOKEN: Auto-generated (push gh-pages)
  # Pas d'autres secrets requis (sécurité minimale)

Rotation:
  GITHUB_TOKEN: Automatique par GitHub
</code></pre>
<h3 id="surface-dattaque">Surface d'Attaque<a class="headerlink" href="#surface-dattaque" title="Permanent link">&para;</a></h3>
<p>Analyse surface d'attaque réduite :</p>
<pre><code class="language-mermaid">graph TB
    A[Attaquant potentiel]

    subgraph &quot;Vecteurs d'attaque&quot;
        B[Compromission repo]
        C[Injection CI/CD]
        D[Malicious PR]
        E[Dependency hijacking]
    end

    subgraph &quot;Défenses&quot;
        F[Branch protection&lt;br/&gt;main + draft]
        G[Code review&lt;br/&gt;requis]
        H[Dependabot&lt;br/&gt;alerts]
        I[Safety + Bandit&lt;br/&gt;scans]
    end

    A --&gt; B
    A --&gt; C
    A --&gt; D
    A --&gt; E

    B --&gt;|Blocked by| F
    C --&gt;|Blocked by| G
    D --&gt;|Blocked by| G
    E --&gt;|Detected by| H
    E --&gt;|Blocked by| I

    style F fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
    style G fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
    style H fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
    style I fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
</code></pre>
<hr />
<h2 id="10-performance-et-optimisations">10. Performance et Optimisations<a class="headerlink" href="#10-performance-et-optimisations" title="Permanent link">&para;</a></h2>
<h3 id="optimisations-appliquees">Optimisations Appliquées<a class="headerlink" href="#optimisations-appliquees" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Optimisation</th>
<th>Impact</th>
<th>Métrique</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker layer cache</td>
<td>-40% build time</td>
<td>5min → 3min</td>
</tr>
<tr>
<td>Pip dependencies cache</td>
<td>-20% install time</td>
<td>90s → 72s</td>
</tr>
<tr>
<td>Strict mode MkDocs</td>
<td>+5% build time</td>
<td>Qualité +++</td>
</tr>
<tr>
<td>PDF isolation (--site-dir)</td>
<td>Évite rebuild HTML</td>
<td>-30s</td>
</tr>
<tr>
<td>Shallow git clone</td>
<td>-10s checkout</td>
<td>depth=1</td>
</tr>
</tbody>
</table>
<h3 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">&para;</a></h3>
<pre><code class="language-mermaid">graph LR
    A[Build Time Evolution]
    B[v0.9: 18min]
    C[v1.0: 12min]
    D[v1.1: 6min]

    B --&gt;|Docker cache| C
    C --&gt;|Pip cache| D

    style D fill:#b7eb8f,stroke:#52c41a,stroke-width:2px
</code></pre>
<hr />
<h2 id="references">Références<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../c4-diagrams/">C4 Diagrams (Architecture)</a></li>
<li><a href="../diagrams/">Diagrammes Mermaid (6 existants)</a></li>
<li><a href="../../adr/003-isolation-pdf-build/">ADR-003: Isolation PDF Build</a></li>
<li><a href="https://github.com/Alexmacapple/span-sg/blob/main/SECURITY.md">SECURITY.md Politique Sécurité</a></li>
<li><a href="https://docs.github.com/en/actions">GitHub Actions Documentation</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>