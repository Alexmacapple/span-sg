
<!DOCTYPE html>
<html lang="fr" data-fr-scheme="system">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../../dsfr.min.css">
    <link rel="stylesheet" href="../../utility/utility.min.css">
    <link rel="stylesheet" href="../../css/theme.css">

    <meta name="theme-color" content="#000091">
    <!-- Défini la couleur de thème du navigateur (Safari/Android) -->
    <link rel="apple-touch-icon" href="../../ favicon /apple-touch-icon.png">
    <!-- 180×180 -->
    <link rel="icon" href="../../favicon/favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="../../favicon/favicon.ico">
    <!-- 32×32 -->
    <link rel="manifest" href="../../favicon/manifest.webmanifest" crossorigin="use-credentials">
    <script src="../../js/postprocess.js" defer></script>

    <!-- Modifier les chemins relatifs des favicons en fonction de la structure du projet -->
    <!-- Dans le fichier manifest.webmanifest aussi, modifier les chemins vers les images -->
    

    <title>Guide Hooks</title>
    
    
</head>
<body>
    <div class="fr-skiplinks">
  <nav role="navigation" aria-label="Accès rapide" class="fr-container">
    <ul class="fr-skiplinks__list">
      <li>
        <a class="fr-link" href="#content">Contenu</a>
      </li>
      <li>
        <a class="fr-link" href="#header-navigation">Menu</a>
      </li>
      
      <li>
        <a class="fr-link" href="#search-modal">Recherche</a>
      </li>
      
      <li>
        <a class="fr-link" href="#footer">Pied de page</a>
      </li>
    </ul>
  </nav>
</div>
    <header role="banner" class="fr-header">
    <div class="fr-header__body">
        <div class="fr-container">
            <div class="fr-header__body-row">
                <div class="fr-header__brand fr-enlarge-link">
                    <div class="fr-header__brand-top">
                        <div class="fr-header__logo">
                            <p class="fr-logo" style="">
                                GOUVERNEMENT
                            </p>
                        </div>

                        <div class="fr-header__navbar">
                            
                            <button
                                class="fr-btn--search fr-btn"
                                data-fr-opened="false"
                                aria-controls="modal-541"
                                id="button-542"
                                title="Rechercher"
                            >
                                Rechercher
                            </button>
                            
                            <button
                                class="fr-btn--menu fr-btn"
                                data-fr-opened="false"
                                aria-controls="modal-543"
                                aria-haspopup="menu"
                                id="button-544"
                                title="Menu"
                            >
                                Menu
                            </button>
                        </div>
                    </div>
                    <div class="fr-header__service">
                        <a href="/" title="Retour à l'accueil du site - SPAN SG">
                            <p class="fr-header__service-title">
                                SPAN SG
                            </p>
                        </a>
                        <p class="fr-header__service-tagline">
                            Schéma Pluriannuel d'Accessibilité Numérique - Secrétariat Général
                        </p>
                    </div>
                </div>
                <div class="fr-header__tools">
                    
                    <div class="fr-header__tools-links">
                        <ul class="fr-btns-group">
                            <li>
                                <a
                                    href="https://github.com/Alexmacapple/span-sg/blob/main/docs/dev/hooks-guide.md"
                                    target="_blank"
                                    rel="noopener"
                                    class="fr-btn"
                                    >Éditer dans GitHub</a
                                >
                            </li>
                        </ul>
                    </div>
                    
                    <div class="fr-header__search fr-modal" id="search-modal">
                        <div class="fr-container fr-container-lg--fluid">
                            <button
                                class="fr-btn--close fr-btn"
                                aria-controls="modal-541"
                                title="Fermer"
                            >
                                Fermer
                            </button>
                            
                            <form action="../../search.html">
                                <div
                                    class="fr-search-bar"
                                    id="search-540"
                                    role="search"
                                >
                                    <label
                                        class="fr-label"
                                        for="mkdocs-search-query"
                                    >
                                        Rechercher
                                    </label>
                                    <input
                                        class="fr-input search_input search-query ui-autocomplete-input"
                                        placeholder="Rechercher"
                                        type="text"
                                        id="mkdocs-search-query"
                                        name="q"
                                    />
                                    <button
                                        class="fr-btn"
                                        title="Rechercher"
                                        type="submit"
                                    >
                                        Rechercher
                                    </button>
                                </div>
                            </form>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div
        class="fr-header__menu fr-modal"
        id="modal-543"
        aria-labelledby="button-544"
    >
        <div class="fr-container">
            <button
                class="fr-btn--close fr-btn"
                aria-controls="modal-543"
                title="Fermer"
            >
                Fermer
            </button>
            <div class="fr-header__menu-links"></div>
            <nav
    class="fr-nav navbar-header"
    id="header-navigation"
    role="navigation"
    aria-label="Menu principal"
>
    <ul class="fr-nav__list">
         
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="../.."
                target="_self"
                
                >SPAN (SG)</a
            >
        </li>
          
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="../../mise-en-application-circulaire/"
                target="_self"
                
                >Contexte réglementaire</a
            >
        </li>
          
        <li class="fr-nav__item">
            <button
                class="fr-nav__btn"
                aria-expanded="false"
                aria-controls="menu-7763"
                
            >
                SPAN (services)
            </button>
            <div class="fr-collapse fr-menu" id="menu-7763">
                <ul class="fr-menu__list">
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/bgs/"
                            target="_self"
                            >BGS</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/safi/"
                            target="_self"
                            >SAFI</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/siep/"
                            target="_self"
                            >SIEP</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/sircom/"
                            target="_self"
                            >SIRCOM</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/snum/"
                            target="_self"
                            >SNUM</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../modules/srh/"
                            target="_self"
                            >SRH</a
                        >
                    </li>
                    
                </ul>
            </div>
        </li>
          
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="../../processus/"
                target="_self"
                
                >Processus</a
            >
        </li>
          
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="../../accompagnement/"
                target="_self"
                
                >Guide d'accompagnement</a
            >
        </li>
          
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="../../synthese/"
                target="_self"
                
                >Synthèse</a
            >
        </li>
          
        <li class="fr-nav__item">
            <button
                class="fr-nav__btn"
                aria-expanded="false"
                aria-controls="menu-7767"
                
                aria-current="true"
                
            >
                Documentation technique
            </button>
            <div class="fr-collapse fr-menu" id="menu-7767">
                <ul class="fr-menu__list">
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../.."
                            target="_self"
                            >Architecture</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../api-reference/"
                            target="_self"
                            >API Reference</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            aria-current="page"
                            
                            href="./"
                            target="_self"
                            >Guide Hooks</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../dsfr-components-guide/"
                            target="_self"
                            >Guide Composants DSFR</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../glossary/"
                            target="_self"
                            >Glossaire</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../onboarding-visual/"
                            target="_self"
                            >Onboarding visuel</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../dev-local/"
                            target="_self"
                            >Développement local</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../contributing/"
                            target="_self"
                            >Guide contributeur</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../.."
                            target="_self"
                            >ADR (Décisions)</a
                        >
                    </li>
                    
                </ul>
            </div>
        </li>
          
        <li class="fr-nav__item">
            <button
                class="fr-nav__btn"
                aria-expanded="false"
                aria-controls="menu-7768"
                
            >
                Informations légales
            </button>
            <div class="fr-collapse fr-menu" id="menu-7768">
                <ul class="fr-menu__list">
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../accessibilite/"
                            target="_self"
                            >Accessibilité</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../mentions-legales/"
                            target="_self"
                            >Mentions légales</a
                        >
                    </li>
                    
                    <li>
                        <a
                            class="fr-nav__link"
                            
                            href="../../donnees-personnelles/"
                            target="_self"
                            >Données personnelles</a
                        >
                    </li>
                    
                </ul>
            </div>
        </li>
          
        <li class="fr-nav__item">
            <a
                class="fr-nav__link"
                href="https://github.com/Alexmacapple/span-sg-repo"
                target="_self"
                
                >Code source GitHub</a
            >
        </li>
         
    </ul>
</nav>
        </div>
    </div>
</header>
    <main id="content" role="main">
        
        <div class="fr-container markdown-content">
            <div class="fr-grid-row">
                
                
                    
                

                
                    
<div class="fr-col-12 fr-col-md-3 fr-py-1v">
    <nav
        class="fr-sidemenu fr-sidemenu--sticky-full-height fr-mb-0-5v"
        role="navigation"
        aria-label="Menu latéral"
    >
        
        <div class="fr-sidemenu__inner">
            <button
                class="fr-sidemenu__btn"
                aria-controls="fr-sidemenu-wrapper"
                aria-expanded="true"
            >
                Guide Développeur - Hooks MkDocs
            </button>
            <div class="fr-collapse" id="fr-sidemenu-wrapper">
                <div class="fr-sidemenu__title">Guide Développeur - Hooks MkDocs</div>
                <ul class="fr-sidemenu__list">
                     
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#introduction"
                            target="_self"
                            >Introduction</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#architecture-hooks"
                            target="_self"
                            >Architecture hooks/</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#cycle-de-vie-hooks-mkdocs"
                            target="_self"
                            >Cycle de vie hooks MkDocs</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#configuration"
                            target="_self"
                            >Configuration</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#creer-un-nouveau-hook"
                            target="_self"
                            >Créer un nouveau hook</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#tests-obligatoires"
                            target="_self"
                            >Tests obligatoires</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#bonnes-pratiques"
                            target="_self"
                            >Bonnes pratiques</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#debugging"
                            target="_self"
                            >Debugging</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#checklist-ajout-hook"
                            target="_self"
                            >Checklist ajout hook</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#checklist-modification-hook"
                            target="_self"
                            >Checklist modification hook</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#erreurs-frequentes"
                            target="_self"
                            >Erreurs fréquentes</a
                        >
                    </li>
                      
                    <li class="fr-sidemenu__item">
                        <a
                            class="fr-sidemenu__link"
                            href="#references"
                            target="_self"
                            >Références</a
                        >
                    </li>
                     
                </ul>
            </div>
        </div>
        
    </nav>
</div>

                    
                        <div id="contenu" class="fr-col-12 fr-col-md-9 fr-py-6v">
                    
                

                

                
                        
                        <h1 id="guide-developpeur-hooks-mkdocs">Guide Développeur - Hooks MkDocs</h1>
<p>Guide pratique pour créer et maintenir des hooks MkDocs personnalisés.</p>
<p>Version: 1.0.1-dsfr
Dernière mise à jour: 2025-10-11</p>
<hr />
<h2 id="introduction">Introduction</h2>
<p>Les hooks MkDocs permettent d'intercepter et modifier le HTML généré à différentes étapes du build. Le projet SPAN SG utilise des hooks Python pour garantir la conformité DSFR.</p>
<p><strong>Hooks actuels:</strong>
- <code>dsfr_table_wrapper.py</code>: Wrappe tables avec <code>&lt;div class="fr-table"&gt;</code>
- <code>title_cleaner.py</code>: Nettoie titres HTML redondants
- <code>pdf_copy.py</code>: Copie PDF dans site/ (non testé)</p>
<hr />
<h2 id="architecture-hooks">Architecture hooks/</h2>
<div class="highlight"><pre><span></span><code>hooks/
├── __init__.py                # Vide (marker Python package)
├── dsfr_table_wrapper.py      # ✅ 100% coverage, 7 tests
├── title_cleaner.py            # ✅ 100% coverage, 6 tests
└── pdf_copy.py                 # ❌ 0% coverage, non testé
</code></pre></div>
<hr />
<h2 id="cycle-de-vie-hooks-mkdocs">Cycle de vie hooks MkDocs</h2>
<h3 id="hooks-disponibles">Hooks disponibles</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_pre_build</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Avant démarrage build.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_files</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Après détection fichiers, avant processing.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_markdown</span><span class="p">(</span><span class="n">markdown</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Après lecture Markdown, avant conversion HTML.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">markdown</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Après conversion Markdown → HTML (body seulement).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">html</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_post_page</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Après génération HTML complète (head + body).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_post_build</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Après build complet.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>
<h3 id="hooks-utilises-par-span-sg">Hooks utilisés par SPAN SG</h3>
<p><strong><code>on_page_content</code></strong> (dsfr_table_wrapper.py):
- Moment: Après Markdown → HTML
- Contenu: Body HTML uniquement (sans <code>&lt;head&gt;</code>)
- Usage: Modifier contenu page (tables, listes, etc.)</p>
<p><strong><code>on_post_page</code></strong> (title_cleaner.py):
- Moment: Après génération HTML complète
- Contenu: HTML complet (<code>&lt;html&gt;</code>, <code>&lt;head&gt;</code>, <code>&lt;body&gt;</code>)
- Usage: Modifier éléments globaux (title, meta, scripts)</p>
<hr />
<h2 id="configuration">Configuration</h2>
<h3 id="mkdocs-dsfryml">mkdocs-dsfr.yml</h3>
<div class="highlight"><pre><span></span><code><span class="nt">hooks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hooks/dsfr_table_wrapper.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hooks/title_cleaner.py</span>

<span class="c1"># Hooks exécutés dans l&#39;ordre listé</span>
<span class="c1"># Chaque hook doit retourner HTML modifié</span>
</code></pre></div>
<hr />
<h2 id="creer-un-nouveau-hook">Créer un nouveau hook</h2>
<h3 id="template-de-base">Template de base</h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Hook MkDocs pour [description courte].</span>

<span class="sd">Date: YYYY-MM-DD</span>
<span class="sd">Contexte: [Pourquoi ce hook existe]</span>
<span class="sd">Solution: [Que fait le hook]</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">Files</span>


<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="s2">&quot;Page&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="s2">&quot;Config&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="s2">&quot;Files&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hook appelé après conversion Markdown → HTML.</span>

<span class="sd">    [Description détaillée du comportement]</span>

<span class="sd">    Contexte:</span>
<span class="sd">        [Problème résolu par ce hook]</span>
<span class="sd">        [Architecture technique]</span>

<span class="sd">    Args:</span>
<span class="sd">        html: Contenu HTML de la page</span>
<span class="sd">        page: Instance MkDocs Page (non utilisé si pas nécessaire)</span>
<span class="sd">        config: Configuration MkDocs (non utilisé si pas nécessaire)</span>
<span class="sd">        files: Collection fichiers (non utilisé si pas nécessaire)</span>

<span class="sd">    Returns:</span>
<span class="sd">        HTML modifié avec [transformation appliquée]</span>

<span class="sd">    Example:</span>
<span class="sd">        Input:  &#39;&lt;before&gt;content&lt;/before&gt;&#39;</span>
<span class="sd">        Output: &#39;&lt;after&gt;content&lt;/after&gt;&#39;</span>

<span class="sd">    Note:</span>
<span class="sd">        [Points d&#39;attention, comportements spéciaux, limitations]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pattern regex pour détecter éléments</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&lt;element&gt;(.*?)&lt;/element&gt;&#39;</span>

    <span class="c1"># Fonction replacement</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;wrapper&gt;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s1">&lt;/wrapper&gt;&#39;</span>

    <span class="c1"># Appliquer transformation</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">html</span>
</code></pre></div>
<h3 id="exemple-complet-link_externalpy">Exemple complet: link_external.py</h3>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Hook MkDocs pour ajouter target=_blank aux liens externes.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.files</span><span class="w"> </span><span class="kn">import</span> <span class="n">Files</span>


<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span>
    <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="s2">&quot;Page&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="s2">&quot;Config&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="s2">&quot;Files&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ajoute target=&quot;_blank&quot; et rel=&quot;noopener&quot; aux liens externes.</span>

<span class="sd">    Contexte:</span>
<span class="sd">        Liens externes doivent s&#39;ouvrir dans nouvel onglet (UX)</span>
<span class="sd">        et avoir rel=&quot;noopener&quot; (sécurité).</span>

<span class="sd">    Args:</span>
<span class="sd">        html: Contenu HTML de la page</span>
<span class="sd">        page: Instance MkDocs Page</span>
<span class="sd">        config: Configuration MkDocs</span>
<span class="sd">        files: Collection fichiers</span>

<span class="sd">    Returns:</span>
<span class="sd">        HTML avec liens externes modifiés</span>

<span class="sd">    Example:</span>
<span class="sd">        Input:  &#39;&lt;a href=&quot;https://example.com&quot;&gt;Link&lt;/a&gt;&#39;</span>
<span class="sd">        Output: &#39;&lt;a href=&quot;https://example.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Link&lt;/a&gt;&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pattern: liens http(s) sans target déjà défini</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&lt;a\s+href=&quot;(https?://[^&quot;]+)&quot;(?![^&gt;]*target=)([^&gt;]*)&gt;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_target</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;a href=&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;</span><span class="si">{</span><span class="n">attrs</span><span class="si">}</span><span class="s1">&gt;&#39;</span>

    <span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">add_target</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">html</span>
</code></pre></div>
<hr />
<h2 id="tests-obligatoires">Tests obligatoires</h2>
<h3 id="template-test">Template test</h3>
<p>Créer <code>tests/test_hooks_mon_hook.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Tests unitaires pour hooks/mon_hook.py&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">hooks.mon_hook</span><span class="w"> </span><span class="kn">import</span> <span class="n">on_page_content</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_cas_nominal</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie comportement nominal.&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;element&gt;content&lt;/element&gt;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;&lt;wrapper&gt;&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;content&quot;</span> <span class="ow">in</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_plusieurs_elements</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie traitement plusieurs éléments.&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;element&gt;A&lt;/element&gt;&lt;element&gt;B&lt;/element&gt;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&lt;wrapper&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_deja_traite</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie idempotence (pas de double traitement).&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;wrapper&gt;&lt;element&gt;content&lt;/element&gt;&lt;/wrapper&gt;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Ne doit pas re-wrapper</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&lt;wrapper&gt;&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_html_vide</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie comportement avec HTML vide.&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_pas_element</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie HTML sans élément ciblé (inchangé).&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;div&gt;Pas d&#39;élément ciblé&lt;/div&gt;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">html</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_avec_attributs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie préservation attributs.&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;element id=&quot;test&quot; class=&quot;foo&quot;&gt;content&lt;/element&gt;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s1">&#39;id=&quot;test&quot;&#39;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s1">&#39;class=&quot;foo&quot;&#39;</span> <span class="ow">in</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_multiligne</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vérifie traitement contenu multiligne.&quot;&quot;&quot;</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;element&gt;</span>
<span class="s2">        &lt;div&gt;</span>
<span class="s2">            Contenu</span>
<span class="s2">            multiligne</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">    &lt;/element&gt;&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;&lt;wrapper&gt;&quot;</span> <span class="ow">in</span> <span class="n">result</span>
</code></pre></div>
<h3 id="execution-tests">Exécution tests</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Tests hooks spécifiques</span>
pytest<span class="w"> </span>tests/test_hooks_mon_hook.py<span class="w"> </span>-v

<span class="c1"># Coverage 100% requis</span>
pytest<span class="w"> </span>tests/test_hooks_mon_hook.py<span class="w"> </span>--cov<span class="o">=</span>hooks.mon_hook<span class="w"> </span>--cov-report<span class="o">=</span>term-missing

<span class="c1"># Tous tests hooks</span>
pytest<span class="w"> </span>tests/test_hooks*.py<span class="w"> </span>-v
</code></pre></div>
<p><strong>Exigences:</strong>
- ✅ Coverage 100% du hook
- ✅ Minimum 5 scénarios (nominal, limites, erreurs, idempotence, edge cases)
- ✅ Black + Ruff conformes</p>
<hr />
<h2 id="bonnes-pratiques">Bonnes pratiques</h2>
<h3 id="1-regex-compiles-performance">1. Regex compilés (performance)</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ✅ BON: Compilé une fois (module-level)</span>
<span class="n">PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">PATTERN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacement</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

<span class="c1"># ❌ MAUVAIS: Compilé à chaque appel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;&#39;</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-type-hints-modernes-pep-563">2. Type hints modernes (PEP 563)</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ✅ BON: TYPE_CHECKING (pas d&#39;import runtime)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="s2">&quot;Page&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># ❌ MAUVAIS: Import direct (overhead runtime, circular imports)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">:</span> <span class="n">Page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div>
<h3 id="3-lookaheadlookbehind-eviter-double-traitement">3. Lookahead/lookbehind (éviter double traitement)</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ✅ BON: Lookahead négatif (ne matche pas si déjà wrappé)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?&lt;!&lt;div class=&quot;fr-table&quot;&gt;)\s*(&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;)&#39;</span>
<span class="c1">#         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Pas déjà précédé par wrapper</span>

<span class="c1"># ❌ MAUVAIS: Pas de vérification (risque double wrapping)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(&lt;table[^&gt;]*&gt;.*?&lt;/table&gt;)&#39;</span>
</code></pre></div>
<h3 id="4-flags-regex-appropries">4. Flags regex appropriés</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># re.DOTALL: . matche newlines (tables/divs multilignes)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="c1"># re.IGNORECASE: Case-insensitive (tags HTML)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;TABLE&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;table&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

<span class="c1"># re.MULTILINE: ^ et $ matchent début/fin lignes</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^#\s+(.*)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&lt;h1&gt;\1&lt;/h1&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
</code></pre></div>
<h3 id="5-docstrings-completes">5. Docstrings complètes</h3>
<p>Structure docstring obligatoire:
- Description courte (1 ligne)
- Description détaillée (paragraphe)
- Contexte (pourquoi ce hook existe)
- Args avec types
- Returns avec type
- Example avec Input/Output
- Note (limitations, cas spéciaux)</p>
<hr />
<h2 id="debugging">Debugging</h2>
<h3 id="logs">Logs</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">page</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">src_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTML length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">html</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>

    <span class="c1"># ... transformation</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transformed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<p><strong>Activer logs:</strong>
<div class="highlight"><pre><span></span><code>mkdocs<span class="w"> </span>build<span class="w"> </span>--verbose
</code></pre></div></p>
<h3 id="tests-locaux">Tests locaux</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Build avec hooks actifs</span>
mkdocs<span class="w"> </span>build<span class="w"> </span>--config-file<span class="w"> </span>mkdocs-dsfr.yml<span class="w"> </span>--strict

<span class="c1"># Serveur local hot-reload</span>
mkdocs<span class="w"> </span>serve<span class="w"> </span>--config-file<span class="w"> </span>mkdocs-dsfr.yml

<span class="c1"># Vérifier HTML généré</span>
grep<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;fr-table&quot;</span><span class="w"> </span>site/
</code></pre></div>
<h3 id="desactiver-hook-temporairement">Désactiver hook temporairement</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># mkdocs-dsfr.yml</span>
<span class="nt">hooks</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># - hooks/dsfr_table_wrapper.py  # Commenté pour debug</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hooks/title_cleaner.py</span>
</code></pre></div>
<hr />
<h2 id="checklist-ajout-hook">Checklist ajout hook</h2>
<h3 id="phase-1-developpement">Phase 1: Développement</h3>
<ul>
<li>[ ] Fichier hook créé dans <code>hooks/mon_hook.py</code></li>
<li>[ ] Type hints complets (TYPE_CHECKING)</li>
<li>[ ] Docstring complète (Args/Returns/Example/Note/Contexte)</li>
<li>[ ] Regex optimisé (compiled, lookahead si besoin)</li>
<li>[ ] Tests unitaires créés <code>tests/test_hooks_mon_hook.py</code></li>
<li>[ ] 5+ scénarios de test (nominal, limites, erreurs, idempotence)</li>
</ul>
<h3 id="phase-2-validation">Phase 2: Validation</h3>
<ul>
<li>[ ] Coverage 100% du hook</li>
<li>[ ] Black formatter passe (<code>black hooks/</code>)</li>
<li>[ ] Ruff linter passe (<code>ruff check hooks/</code>)</li>
<li>[ ] Tests unitaires passent (<code>pytest tests/test_hooks_mon_hook.py</code>)</li>
<li>[ ] Build local réussit (<code>mkdocs build --config-file mkdocs-dsfr.yml</code>)</li>
</ul>
<h3 id="phase-3-integration">Phase 3: Intégration</h3>
<ul>
<li>[ ] Hook ajouté à <code>mkdocs-dsfr.yml</code> section <code>hooks:</code></li>
<li>[ ] Documentation ajoutée dans <code>docs/dev/hooks-guide.md</code></li>
<li>[ ] API Reference mise à jour (<code>docs/dev/api-reference.md</code>)</li>
<li>[ ] Commit avec message explicatif</li>
</ul>
<h3 id="phase-4-ci">Phase 4: CI</h3>
<ul>
<li>[ ] CI passe (Black, Ruff, pytest, coverage 89%+)</li>
<li>[ ] GitHub Pages déploie correctement</li>
<li>[ ] Validation visuelle site déployé</li>
</ul>
<hr />
<h2 id="checklist-modification-hook">Checklist modification hook</h2>
<h3 id="phase-1-modifications">Phase 1: Modifications</h3>
<ul>
<li>[ ] Tests existants toujours passent</li>
<li>[ ] Nouveaux tests pour nouvelle logique</li>
<li>[ ] Coverage maintenu 100%</li>
</ul>
<h3 id="phase-2-documentation">Phase 2: Documentation</h3>
<ul>
<li>[ ] Docstring mise à jour</li>
<li>[ ] Exemple mis à jour si changement comportement</li>
<li>[ ] CHANGELOG.md entry créée</li>
</ul>
<h3 id="phase-3-validation">Phase 3: Validation</h3>
<ul>
<li>[ ] Black + Ruff passent</li>
<li>[ ] Build local réussit</li>
<li>[ ] CI passe</li>
</ul>
<hr />
<h2 id="erreurs-frequentes">Erreurs fréquentes</h2>
<h3 id="erreur-1-import-circulaire">Erreur 1: Import circulaire</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ MAUVAIS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>  <span class="c1"># Circular import!</span>

<span class="c1"># ✅ BON</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mkdocs.structure.pages</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>
</code></pre></div>
<h3 id="erreur-2-regex-non-greedy-oublie">Erreur 2: Regex non-greedy oublié</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ MAUVAIS: Greedy (matche tout jusqu&#39;au dernier &lt;/table&gt;)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&lt;table&gt;(.*)&lt;/table&gt;&#39;</span>

<span class="c1"># ✅ BON: Non-greedy (matche table par table)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&lt;table&gt;(.*?)&lt;/table&gt;&#39;</span>
</code></pre></div>
<h3 id="erreur-3-oublier-flags-redotall">Erreur 3: Oublier flags re.DOTALL</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ MAUVAIS: . ne matche pas \n (tables multilignes échouent)</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;table&gt;.*?&lt;/table&gt;&#39;</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

<span class="c1"># ✅ BON: . matche tout y compris \n</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;table&gt;.*?&lt;/table&gt;&#39;</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</code></pre></div>
<h3 id="erreur-4-modifier-html-sans-retourner">Erreur 4: Modifier HTML sans retourner</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ MAUVAIS: Modifie mais ne retourne pas</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;old&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;new&gt;&#39;</span><span class="p">)</span>  <span class="c1"># str.replace ne modifie pas en place!</span>
    <span class="c1"># Manque: return html</span>

<span class="c1"># ✅ BON</span>
<span class="k">def</span><span class="w"> </span><span class="nf">on_page_content</span><span class="p">(</span><span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;old&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;new&gt;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">html</span>
</code></pre></div>
<hr />
<h2 id="references">Références</h2>
<p><strong>Documentation MkDocs:</strong>
- <a href="https://www.mkdocs.org/user-guide/plugins/">Developing Plugins</a>
- <a href="https://www.mkdocs.org/dev-guide/plugins/">Plugin API Reference</a></p>
<p><strong>Hooks SPAN SG:</strong>
- <code>hooks/dsfr_table_wrapper.py</code>: Exemple complet avec tests
- <code>hooks/title_cleaner.py</code>: Exemple simple et efficace
- <code>tests/test_hooks*.py</code>: Exemples tests exhaustifs</p>
<p><strong>Standards:</strong>
- PEP 8: Style guide Python
- PEP 484: Type hints
- PEP 563: Postponed evaluation (TYPE_CHECKING)</p>
<p><strong>Outils:</strong>
- Black: Code formatter
- Ruff: Linter rapide
- pytest: Framework tests
- pytest-cov: Coverage measurement</p>
                        
                        
                        <div id="backtop" class="fr-grid-row fr-grid-row--right"></div>
                        
                    </div>
                    <hr />
                    
	<nav role="navigation" class="fr-pagination fr-mx-auto" aria-label="Pagination">
		<ul class="fr-pagination__list">
			<li><a class="fr-pagination__link fr-pagination__link--prev fr-pagination__link--lg-label"  href="../api-reference/" title="API Reference" >
				Page précédente
			</a></li>
			<li><a class="fr-pagination__link fr-pagination__link--next fr-pagination__link--lg-label"  href="../dsfr-components-guide/" title="Guide Composants DSFR" >
				Page suivante
			</a></li>
		</ul>
	</nav>

                </div>
            </div>
            <dialog id="fr-theme-modal" class="fr-modal" role="dialog" aria-labelledby="fr-theme-modal-title">
                <div class="fr-container fr-container--fluid fr-container-md">
                    <div class="fr-grid-row fr-grid-row--center">
                        <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
                            <div class="fr-modal__body">
                                <div class="fr-modal__header">
                                    <button class="fr-btn--close fr-btn" aria-controls="fr-theme-modal" title="Fermer">
                                        Fermer
                                    </button>
                                </div>
                                <div class="fr-modal__content">
                                    <h1 id="fr-theme-modal-title" class="fr-modal__title">
                                        Paramètres d’affichage </h1>
                                    <div id="fr-display" class="fr-display">
                                        <div class="fr-form-group">
                                            <fieldset class="fr-fieldset">
                                                <legend class="fr-fieldset__legend fr-text--regular" id='-legend'>
                                                    Choisissez un thème pour personnaliser l’apparence du site.
                                                </legend>
                                                <div class="fr-fieldset__content">
                                                    <div class="fr-radio-group fr-radio-rich"><input value="light"
                                                            type="radio" id="fr-radios-theme-light"
                                                            name="fr-radios-theme">
                                                        <label class="fr-label" for="fr-radios-theme-light"> Thème
                                                            clair </label>
                                                        <div class="fr-radio-rich__img">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="fr-artwork"
                                                                width="80px" height="80px" viewBox="0 0 80 80">
                                                                <use class="fr-artwork-decorative"
                                                                    xlink:href="../../artwork/light.svg#artwork-decorative">
                                                                </use>
                                                                <use class="fr-artwork-minor"
                                                                    xlink:href="../../artwork/light.svg#artwork-minor">
                                                                </use>
                                                                <use class="fr-artwork-major"
                                                                    xlink:href="../../artwork/light.svg#artwork-major">
                                                                </use>
                                                            </svg>
                                                        </div>
                                                    </div>
                                                    <div class="fr-radio-group fr-radio-rich"><input value="dark"
                                                            type="radio" id="fr-radios-theme-dark"
                                                            name="fr-radios-theme">
                                                        <label class="fr-label" for="fr-radios-theme-dark"> Thème
                                                            sombre </label>
                                                        <div class="fr-radio-rich__img">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="fr-artwork"
                                                                width="80px" height="80px" viewBox="0 0 80 80">
                                                                <use class="fr-artwork-decorative"
                                                                    xlink:href="../../artwork/dark.svg#artwork-decorative">
                                                                </use>
                                                                <use class="fr-artwork-minor"
                                                                    xlink:href="../../artwork/dark.svg#artwork-minor">
                                                                </use>
                                                                <use class="fr-artwork-major"
                                                                    xlink:href="../../artwork/dark.svg#artwork-major">
                                                                </use>
                                                            </svg>
                                                        </div>
                                                    </div>
                                                    <div class="fr-radio-group fr-radio-rich"><input value="system"
                                                            type="radio" id="fr-radios-theme-system"
                                                            name="fr-radios-theme">
                                                        <label class="fr-label" for="fr-radios-theme-system"> Système
                                                            <span class="fr-hint-text">Utilise les paramètres
                                                                système.</span>
                                                        </label>
                                                        <div class="fr-radio-rich__img">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="fr-artwork"
                                                                width="80px" height="80px" viewBox="0 0 80 80">
                                                                <use class="fr-artwork-decorative"
                                                                    xlink:href="../../artwork/system.svg#artwork-decorative">
                                                                </use>
                                                                <use class="fr-artwork-minor"
                                                                    xlink:href="../../artwork/system.svg#artwork-minor">
                                                                </use>
                                                                <use class="fr-artwork-major"
                                                                    xlink:href="../../artwork/system.svg#artwork-major">
                                                                </use>
                                                            </svg>
                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </dialog>
    </main>
    <footer class="fr-footer" role="contentinfo" id="footer">
    <div class="fr-container">
        <div class="fr-footer__body">
            <div class="fr-footer__brand fr-enlarge-link">
                <a href="/"
                    title="Retour à l'accueil du site - Nom de l'entité (ministère, secrétariat d'état, gouvernement)">
                    <p class="fr-logo">
                        GOUVERNEMENT
                    </p>
                </a>
            </div>
            <div class="fr-footer__content">
                <p class="fr-footer__content-desc">Schéma Pluriannuel d'Accessibilité Numérique du Secrétariat Général - Ministère de l'Économie des Finances et de la Souveraineté industrielle et énergétique</p>
                <ul class="fr-footer__content-list">
                    
                    
                    <li class="fr-footer__content-item">
                        <a class="fr-footer__content-link" target="_blank" href="https://legifrance.gouv.fr">legifrance.gouv.fr</a>
                    </li>
                    
                    <li class="fr-footer__content-item">
                        <a class="fr-footer__content-link" target="_blank" href="https://service-public.fr">service-public.fr</a>
                    </li>
                    
                    <li class="fr-footer__content-item">
                        <a class="fr-footer__content-link" target="_blank" href="https://data.gouv.fr">data.gouv.fr</a>
                    </li>
                    
                    <li class="fr-footer__content-item">
                        <a class="fr-footer__content-link" target="_blank" href="https://info.gouv.fr">info.gouv.fr</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="fr-footer__bottom">
            <ul class="fr-footer__bottom-list">
                
                <li class="fr-footer__bottom-item">
                    <a class="fr-footer__bottom-link" href="/span-sg-repo/accessibilite/">Accessibilité : conformité partielle</a>
                </li>
                
                <li class="fr-footer__bottom-item">
                    <a class="fr-footer__bottom-link" href="/span-sg-repo/mentions-legales/">Mentions légales</a>
                </li>
                
                <li class="fr-footer__bottom-item">
                    <a class="fr-footer__bottom-link" href="/span-sg-repo/donnees-personnelles/">Données personnelles</a>
                </li>
                
                <li class="fr-footer__bottom-item">
                    <button class="fr-footer__bottom-link fr-fi-theme-fill fr-link--icon-left"
                        aria-controls="fr-theme-modal" data-fr-opened="false">Paramètres d'affichage</button>
                </li>
            </ul>
            <div class="fr-footer__bottom-copy">
                <p>Sauf mention contraire, tous les contenus de ce site sont sous <a
                        href="https://github.com/etalab/licence-ouverte/blob/master/LO.md" target="_blank">licence
                        etalab-2.0</a>
                </p>
            </div>
        </div>
    </div>
</footer>

    
<div class="revision-date">
    
    Dernière révision le <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="23 octobre 2025 15:36:29 UTC">23 octobre 2025</span> 
</div>


<script>
    var base_url = "../..";
</script>

<script type="module" src="../../dsfr.module.min.js"></script>
<script
    type="text/javascript"
    nomodule
    src="../../dsfr.nomodule.min.js"
></script>
<script src="../../search/lunr.js"></script>
<script src="../../search/lunr.stemmer.support.js"></script>
<script src="../../search/lunr.fr.js"></script>
<script src="../../assets/extra.js" defer></script>
<script src="../../search/main.js" defer></script>
<script src="../../js/open_in_new_tab.js" defer></script>
</body>

</html>
